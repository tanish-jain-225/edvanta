import React, { useState, useEffect } from 'react';\nimport { AlertTriangle, CheckCircle, XCircle, RefreshCw, ExternalLink } from 'lucide-react';\nimport { Button } from '../ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '../ui/card';\nimport testUtils from '../../utils/test-visual';\n\nconst VisualGenerationDiagnostics = ({ className = \"\" }) => {\n  const [diagnostics, setDiagnostics] = useState(null);\n  const [isRunning, setIsRunning] = useState(false);\n\n  const runDiagnostics = async () => {\n    setIsRunning(true);\n    try {\n      const results = await testUtils.runSystemCheck();\n      setDiagnostics(results);\n    } catch (error) {\n      console.error('Diagnostics failed:', error);\n      setDiagnostics({\n        error: error.message,\n        timestamp: new Date().toISOString()\n      });\n    } finally {\n      setIsRunning(false);\n    }\n  };\n\n  useEffect(() => {\n    // Run diagnostics on mount\n    runDiagnostics();\n  }, []);\n\n  const getStatusIcon = (isSuccess) => {\n    if (isSuccess) {\n      return <CheckCircle className=\"h-5 w-5 text-green-500\" />;\n    }\n    return <XCircle className=\"h-5 w-5 text-red-500\" />;\n  };\n\n  const getStatusColor = (isSuccess) => {\n    return isSuccess ? 'text-green-700 bg-green-50 border-green-200' : 'text-red-700 bg-red-50 border-red-200';\n  };\n\n  return (\n    <Card className={`w-full ${className}`}>\n      <CardHeader>\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"flex items-center gap-2\">\n            <AlertTriangle className=\"h-5 w-5 text-amber-500\" />\n            System Diagnostics\n          </CardTitle>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={runDiagnostics}\n            disabled={isRunning}\n            className=\"flex items-center gap-2\"\n          >\n            <RefreshCw className={`h-4 w-4 ${isRunning ? 'animate-spin' : ''}`} />\n            {isRunning ? 'Checking...' : 'Re-check'}\n          </Button>\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {diagnostics?.error ? (\n          <div className=\"p-4 rounded-lg bg-red-50 border border-red-200\">\n            <p className=\"text-sm text-red-700\">\n              <strong>Diagnostics Error:</strong> {diagnostics.error}\n            </p>\n          </div>\n        ) : diagnostics ? (\n          <div className=\"space-y-3\">\n            {/* Environment Check */}\n            <div className={`p-3 rounded-lg border ${getStatusColor(diagnostics.environment.isValid)}`}>\n              <div className=\"flex items-center gap-2 mb-2\">\n                {getStatusIcon(diagnostics.environment.isValid)}\n                <span className=\"font-medium\">Environment Configuration</span>\n              </div>\n              {!diagnostics.environment.isValid && (\n                <ul className=\"text-sm space-y-1 ml-7\">\n                  {diagnostics.environment.issues.map((issue, index) => (\n                    <li key={index} className=\"flex items-start gap-1\">\n                      <span className=\"text-red-500\">•</span>\n                      <span>{issue}</span>\n                    </li>\n                  ))}\n                </ul>\n              )}\n              {diagnostics.environment.isValid && (\n                <p className=\"text-sm ml-7\">All environment variables are configured correctly.</p>\n              )}\n            </div>\n\n            {/* API Check */}\n            <div className={`p-3 rounded-lg border ${getStatusColor(diagnostics.api.success)}`}>\n              <div className=\"flex items-center gap-2 mb-2\">\n                {getStatusIcon(diagnostics.api.success)}\n                <span className=\"font-medium\">Backend API Connection</span>\n              </div>\n              {diagnostics.api.success ? (\n                <p className=\"text-sm ml-7\">\n                  Connected successfully (Status: {diagnostics.api.status})\n                </p>\n              ) : (\n                <p className=\"text-sm ml-7\">\n                  Connection failed: {diagnostics.api.error}\n                </p>\n              )}\n            </div>\n\n            {/* Cloudinary Check */}\n            <div className={`p-3 rounded-lg border ${getStatusColor(diagnostics.cloudinary.success)}`}>\n              <div className=\"flex items-center gap-2 mb-2\">\n                {getStatusIcon(diagnostics.cloudinary.success)}\n                <span className=\"font-medium\">Cloudinary Upload Service</span>\n              </div>\n              {diagnostics.cloudinary.success ? (\n                <p className=\"text-sm ml-7\">\n                  Upload service is working correctly.\n                </p>\n              ) : (\n                <p className=\"text-sm ml-7\">\n                  Upload failed: {diagnostics.cloudinary.error}\n                </p>\n              )}\n            </div>\n\n            {/* Timestamp */}\n            <div className=\"text-xs text-gray-500 text-center pt-2\">\n              Last checked: {new Date(diagnostics.timestamp).toLocaleString()}\n            </div>\n          </div>\n        ) : (\n          <div className=\"flex items-center justify-center py-6\">\n            <RefreshCw className=\"h-6 w-6 animate-spin text-blue-500 mr-2\" />\n            <span className=\"text-sm text-gray-600\">Running diagnostics...</span>\n          </div>\n        )}\n\n        {/* Troubleshooting Tips */}\n        <div className=\"mt-6 pt-4 border-t border-gray-200\">\n          <h4 className=\"text-sm font-medium text-gray-900 mb-2\">Troubleshooting Tips:</h4>\n          <ul className=\"text-xs text-gray-600 space-y-1\">\n            <li className=\"flex items-start gap-1\">\n              <span>•</span>\n              <span>If API connection fails, check if the backend server is running</span>\n            </li>\n            <li className=\"flex items-start gap-1\">\n              <span>•</span>\n              <span>For Cloudinary issues, verify your cloud name and upload preset in .env</span>\n            </li>\n            <li className=\"flex items-start gap-1\">\n              <span>•</span>\n              <span>Environment issues usually require updating your .env file</span>\n            </li>\n            <li className=\"flex items-start gap-1\">\n              <span>•</span>\n              <span>Try refreshing the page if diagnostics show outdated results</span>\n            </li>\n          </ul>\n        </div>\n\n        {/* Documentation Link */}\n        <div className=\"pt-2\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            className=\"text-xs text-blue-600 hover:text-blue-800 p-0 h-auto\"\n            onClick={() => window.open('https://github.com/tanish-jain-225/edvanta', '_blank')}\n          >\n            <ExternalLink className=\"h-3 w-3 mr-1\" />\n            View Documentation\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n};\n\nexport default VisualGenerationDiagnostics;